{% extends "index.html" %}
{% block title %}Состав{% endblock %}
{% block content %}
<div class="page-head">
  <h1>Состав организаций</h1>
  <div class="actions"><a class="btn" href="{% url 'core:membership-create' %}">Добавить</a></div>
</div>

<form method="get" class="form card" style="margin-bottom:14px;">
  <div class="form-grid">
    <div class="field">
      <label class="label">Поиск</label>
      <input class="input" type="text" name="q" value="{{ q }}" placeholder="user / организация / должность">
    </div>

    <div class="field">
      <label class="label">Организация</label>
      <select class="select" name="org">
        <option value="">Все</option>
        {% for o in orgs %}
          <option value="{{ o.id }}" {% if org == o.id|stringformat:"s" %}selected{% endif %}>{{ o.organization_name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label class="label">Должность</label>
      <select class="select" name="pos">
        <option value="">Все</option>
        {% for p in positions %}
          <option value="{{ p.id }}" {% if pos == p.id|stringformat:"s" %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label class="label">Статус</label>
      <select class="select" name="status">
        {% for val, label in status_options %}
          <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label class="label">Сортировка</label>
      <select class="select" name="sort">
        {% for val, label in sort_options %}
          <option value="{{ val }}" {% if sort == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label class="label">&nbsp;</label>
      <div class="actions" style="margin-top:0;">
        <button class="btn" type="submit">Применить</button>
        <a class="btn ghost" href="{% url 'core:membership-list' %}">Сброс</a>
      </div>
    </div>
  </div>
</form>

{% if object_list %}
<table class="table">
  <thead>
    <tr>
      <th>Пользователь</th>
      <th>Организация</th>
      <th>Должность</th>
      <th>Прием</th>
      <th>Увольнение</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for m in object_list %}
    <tr>
      <td>{{ m.user }}</td>
      <td><a class="link" href="{% url 'core:organization-detail' m.organization_id %}">{{ m.organization }}</a></td>
      <td><a class="link" href="{% url 'core:membership-detail' m.pk %}">{{ m.position }}</a></td>
      <td class="muted">{{ m.hire_date }}</td>
      <td class="muted">{{ m.dismissal_date|default:"—" }}</td>
      <td class="right">
        <a class="btn ghost sm" href="{% url 'core:membership-update' m.pk %}">Изменить</a>
        <a class="btn danger sm" href="{% url 'core:membership-delete' m.pk %}">Удалить</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty">Пока нет записей</div>
{% endif %}

{% include "core/pagination.html" %}
{% endblock %}